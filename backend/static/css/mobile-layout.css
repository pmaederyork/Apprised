/**
 * Mobile Layout System
 * Handles portrait/landscape split views and chat-only mode.
 * Uses CSS Grid for flexible layout switching.
 */

/* ===== Chat-only Mode ===== */
/* Full-screen chat when no document is open */
body.is-mobile.chat-only-mode .chat-container {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: var(--keyboard-height, 0px);
  height: auto;
  width: 100%;
  display: flex;
  flex-direction: column;
  /* No transition on bottom - iOS keyboard needs instant response to prevent double-render */
}

/* Standalone PWA mode: add padding for safe areas */
@media (display-mode: standalone) {
  body.is-mobile.chat-only-mode .chat-container {
    /* Top safe area handled by chat-header padding in mobile-panels.css */
    padding-left: env(safe-area-inset-left, 0px);
    padding-right: env(safe-area-inset-right, 0px);
    /* Bottom safe area handled by chat-input-container */
  }
}

body.is-mobile.chat-only-mode .document-editor {
  display: none;
}

body.is-mobile.chat-only-mode .system-prompt-editor {
  display: none;
}

/* ===== Split View Container ===== */
/* Grid layout for when document is open */
body.is-mobile.split-view .app-container {
  display: grid;
  overflow: hidden;
  box-sizing: border-box;
  height: 100vh;
  height: 100dvh;
  height: calc(100dvh - var(--keyboard-height, 0px));
  /* No transition on height - iOS keyboard needs instant response */
  /* Safe areas handled by padding in mobile.css */
}

/* Standalone PWA mode: use fixed positioning for split view too */
@media (display-mode: standalone) {
  body.is-mobile.split-view .app-container {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: var(--keyboard-height, 0px);
    height: auto;
    padding: 0;
    /* Top safe area handled by mobile-editor-header padding in mobile-panels.css */
    /* Bottom safe area handled by chat-input-container */
    /* No transition - iOS keyboard needs instant response to prevent double-render */
  }
}

/* ===== Portrait Split View ===== */
/* Editor top 50%, chat bottom 50% */
body.is-mobile.is-portrait.split-view .app-container {
  grid-template-rows: 50% 50%;
  grid-template-columns: 1fr;
  grid-template-areas:
    "editor"
    "chat";
}

body.is-mobile.is-portrait.split-view .document-editor {
  grid-area: editor;
  overflow: hidden;
  display: flex !important;
  flex-direction: column;
  min-width: 0; /* Allow shrinking */
  height: auto;
  border-bottom: 2px solid var(--color-border);
}

body.is-mobile.is-portrait.split-view .chat-container {
  grid-area: chat;
  overflow: hidden;
  display: flex !important;
  flex-direction: column;
  position: relative !important; /* Reset from chat-only fixed positioning */
  top: auto !important;
  left: auto !important;
  right: auto !important;
  bottom: auto !important;
  width: auto !important;
  height: auto !important;
  min-height: 0; /* Allow shrinking in grid */
}

/* ===== Landscape Split View ===== */
/* Chat left 50%, editor right 50% */
body.is-mobile.is-landscape.split-view .app-container {
  grid-template-rows: 1fr;
  grid-template-columns: 50% 50%;
  grid-template-areas: "chat editor";
}

body.is-mobile.is-landscape.split-view .chat-container {
  grid-area: chat;
  overflow: hidden;
  display: flex !important;
  flex-direction: column;
  position: relative !important;
  top: auto !important;
  left: auto !important;
  right: auto !important;
  bottom: auto !important;
  width: auto !important;
  height: auto !important;
  min-width: 0;
  border-right: 2px solid var(--color-border);
}

body.is-mobile.is-landscape.split-view .document-editor {
  grid-area: editor;
  overflow: hidden;
  display: flex !important;
  flex-direction: column;
  min-width: 0;
}

/* ===== Tablet Layout ===== */
/* Always use landscape layout (50/50 side-by-side) regardless of orientation */
body.is-tablet.split-view .app-container {
  grid-template-rows: 1fr;
  grid-template-columns: 50% 50%;
  grid-template-areas: "chat editor";
}

body.is-tablet.split-view .chat-container {
  grid-area: chat;
  overflow: hidden;
  display: flex !important;
  flex-direction: column;
  position: relative !important;
  top: auto !important;
  left: auto !important;
  right: auto !important;
  bottom: auto !important;
  width: auto !important;
  height: auto !important;
  min-width: 0;
  border-right: 2px solid var(--color-border);
}

body.is-tablet.split-view .document-editor {
  grid-area: editor;
  overflow: hidden;
  display: flex !important;
  flex-direction: column;
  min-width: 0;
}

/* ===== Collapsed Chat State ===== */
/* Minimizes chat to thin bar for focused editing */

/* Portrait: chat collapses to bottom bar */
body.is-mobile.is-portrait.split-view.chat-collapsed .app-container {
  grid-template-rows: 1fr var(--mobile-collapsed-chat-height);
}

body.is-mobile.is-portrait.split-view.chat-collapsed .chat-container {
  min-height: var(--mobile-collapsed-chat-height);
  max-height: var(--mobile-collapsed-chat-height);
  overflow: hidden;
}

body.is-mobile.is-portrait.split-view.chat-collapsed .document-editor {
  height: 100%;
  min-height: 0;
  overflow: hidden;
}

/* Landscape: chat collapses to left sidebar */
body.is-mobile.is-landscape.split-view.chat-collapsed .app-container {
  grid-template-columns: var(--mobile-collapsed-chat-height) 1fr;
}

body.is-mobile.is-landscape.split-view.chat-collapsed .chat-container {
  min-width: var(--mobile-collapsed-chat-height);
  max-width: var(--mobile-collapsed-chat-height);
  overflow: hidden;
}

body.is-mobile.is-landscape.split-view.chat-collapsed .document-editor {
  width: 100%;
  min-width: 0;
  overflow: hidden;
}

/* ===== Non-Grid Elements on Mobile ===== */
/* These elements use position: fixed and don't participate in grid */
/* Sidebar handled by mobile-drawer.css */
/* Drawer backdrop handled by mobile-drawer.css */

/* System prompt editor - hide in split view unless active */
body.is-mobile.split-view .system-prompt-editor:not(.active) {
  display: none;
}

/* ===== Smooth Transitions ===== */
/* Animate layout changes for orientation changes only */
/* NO transitions on keyboard-related properties (height, bottom) - causes double-render on iOS */
body.is-mobile .app-container {
  transition: grid-template-rows 300ms ease-out,
              grid-template-columns 300ms ease-out;
}

body.is-mobile .chat-container,
body.is-mobile .document-editor {
  transition: min-height 300ms ease-out, max-height 300ms ease-out,
              min-width 300ms ease-out, max-width 300ms ease-out;
}

/* ===== Desktop Override ===== */
/* Desktop layout preserved - grid only applies when body.is-mobile.split-view is present */
/* No media query needed - JS controls body.is-mobile class based on MOBILE_BREAKPOINT */
