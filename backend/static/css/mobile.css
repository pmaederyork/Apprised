/**
 * Mobile Foundation Styles
 * Breakpoint detection, safe area support, and mobile state management.
 *
 * MOBILE BREAKPOINT: 500px
 * Change this value in mobile.js MOBILE_BREAKPOINT constant.
 * The JS sets body.is-mobile class, which most styles should use.
 * Media queries below use 500px/501px to match - update if breakpoint changes.
 */

/* Mobile CSS Variables */
:root {
  --mobile-sidebar-width: 80%;
  --mobile-header-height: 48px;
  --mobile-collapsed-chat-height: 44px;
  /* Keyboard handling variables */
  --composer-height: 68px;
  --safe-area-bottom: env(safe-area-inset-bottom, 0px);
  --safe-area-top: env(safe-area-inset-top, 0px);
}

/* ===== Mobile Body Class Styles ===== */
/* Applied by JavaScript when mobile detected (width < 500px) */

body.is-mobile .sidebar {
  display: none; /* Hidden by default on mobile, shown via drawer */
}

body.is-mobile .hamburger-btn {
  display: flex; /* Show hamburger on mobile */
}

/* Desktop: Hamburger Hidden */
.hamburger-btn {
  display: none;
}

/* ===== Orientation-Specific Styles ===== */
body.is-mobile.is-portrait {
  /* Portrait-specific overrides in mobile-layout.css */
}

body.is-mobile.is-landscape {
  /* Landscape-specific overrides in mobile-layout.css */
}

/* ===== Mobile Viewport Constraints ===== */
body.is-mobile {
  height: 100%;
  overflow: hidden;
  position: fixed;
  width: 100%;
  overscroll-behavior: none; /* Prevent elastic scroll bounce */
  background: var(--color-bg-white);
}

/* ===== Standalone PWA Mode ===== */
/* Additional handling when launched from home screen */
@media (display-mode: standalone) {
  html {
    background: var(--color-bg-white) !important;
  }

  body {
    background: var(--color-bg-white) !important;
  }

  /* Dark mode */
  html[data-theme="dark"], html[data-theme="dark"] body {
    background: var(--gray-900, #1c1917) !important;
  }
}

/* Prevent overscroll on main containers */
body.is-mobile .app-container,
body.is-mobile .chat-container,
body.is-mobile .document-editor {
  overscroll-behavior: contain; /* Contain scroll within element */
}

/* Prevent containing block issues on composer ancestors */
body.is-mobile .chat-container {
  transform: none;
  filter: none;
  backdrop-filter: none;
  perspective: none;
  will-change: auto;
}

/* Ensure app container fills viewport and has solid background */
body.is-mobile .app-container {
  background: var(--color-bg-white);
}

body.is-mobile * {
  -webkit-tap-highlight-color: transparent;
}

body.is-mobile input,
body.is-mobile textarea {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  user-select: text;
}

/* Safe Area Insets - iOS notch and home indicator support */
/* In regular browser mode, env() returns 0 (browser handles safe areas) */
/* In standalone PWA mode, env() returns actual values */
/* Note: Individual elements (headers, input containers) handle their own safe areas */
/* to avoid double-padding issues */
body.is-mobile .app-container {
  padding-left: env(safe-area-inset-left, 0px);
  padding-right: env(safe-area-inset-right, 0px);
  /* Top/bottom handled by individual elements to avoid stacking */
}

/* ===== Utility Classes ===== */
/* Hide on mobile */
.hide-mobile {
  display: block;
}

body.is-mobile .hide-mobile {
  display: none !important;
}

/* Show only on mobile */
.show-mobile {
  display: none;
}

body.is-mobile .show-mobile {
  display: block !important;
}

/* ===== Mobile Input Handling ===== */
/* Prevent iOS zoom on input focus - requires 16px minimum font-size */
body.is-mobile input,
body.is-mobile textarea,
body.is-mobile select {
  font-size: 16px !important;
  /* Allow normal touch interactions on inputs */
  touch-action: manipulation;
}

/* Re-enable touch scrolling for internal scrollable containers */
body.is-mobile .chat-input-container,
body.is-mobile .document-editor-content,
body.is-mobile .editor-content,
body.is-mobile .sidebar-content,
body.is-mobile .modal-content,
body.is-mobile [contenteditable="true"] {
  touch-action: pan-y;
}

/* Ensure chat messages area can shrink */
body.is-mobile .chat-messages {
  flex: 1;
  min-height: 0;
  overflow-y: auto;
  /* Re-enable touch scrolling for this container */
  touch-action: pan-y;
  /* Scroll containment for iOS keyboard */
  overscroll-behavior: contain;
  -webkit-overflow-scrolling: touch;
}

/* Modals with inputs should be scrollable */
body.is-mobile .modal-content {
  max-height: calc(100vh - 40px);
  overflow-y: auto;
}
