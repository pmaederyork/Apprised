/**
 * Mobile Foundation Styles
 * Breakpoint detection, safe area support, and mobile state management.
 *
 * MOBILE BREAKPOINT: 500px
 * Change this value in mobile.js MOBILE_BREAKPOINT constant.
 * The JS sets body.is-mobile class, which most styles should use.
 * Media queries below use 500px/501px to match - update if breakpoint changes.
 */

/* Mobile CSS Variables */
:root {
  --mobile-sidebar-width: 80%;
  --mobile-header-height: 48px;
  --mobile-collapsed-chat-height: 44px;
  --keyboard-height: 0px;
}

/* ===== Mobile Body Class Styles ===== */
/* Applied by JavaScript when mobile detected (width < 500px) */

/* Lock both html and body to prevent any page scrolling on mobile */
html:has(body.is-mobile) {
  position: fixed;
  overflow: hidden;
  width: 100%;
  height: 100%;
  /* Disable smooth scroll on mobile - interferes with keyboard handling */
  scroll-behavior: auto !important;
}

body.is-mobile {
  overflow: hidden; /* Prevent body scroll, app handles scroll */
}

body.is-mobile .sidebar {
  display: none; /* Hidden by default on mobile, shown via drawer */
}

body.is-mobile .hamburger-btn {
  display: flex; /* Show hamburger on mobile */
}

/* Desktop: Hamburger Hidden */
.hamburger-btn {
  display: none;
}

/* ===== Orientation-Specific Styles ===== */
body.is-mobile.is-portrait {
  /* Portrait-specific overrides in mobile-layout.css */
}

body.is-mobile.is-landscape {
  /* Landscape-specific overrides in mobile-layout.css */
}

/* ===== Mobile Viewport Constraints ===== */
/* These use media query because they affect html/body before JS runs */
body.is-mobile {
  /* Prevent iOS Safari bounce/overscroll effect */
  position: fixed;
  width: 100%;
  height: 100%;
  overscroll-behavior: none; /* Prevent elastic scroll bounce */
  /* Use neutral background to prevent blue showing during scroll/keyboard */
  background: var(--color-bg-white);
}

/* Prevent overscroll on main containers */
body.is-mobile .app-container,
body.is-mobile .chat-container,
body.is-mobile .document-editor {
  overscroll-behavior: contain; /* Contain scroll within element */
}

/* Ensure app container fills viewport and has solid background */
body.is-mobile .app-container {
  background: var(--color-bg-white);
}

body.is-mobile * {
  -webkit-tap-highlight-color: transparent;
}

body.is-mobile input,
body.is-mobile textarea {
  -webkit-touch-callout: default;
  -webkit-user-select: text;
  user-select: text;
}

/* Safe Area Insets - iOS notch and home indicator support */
body.is-mobile .app-container {
  padding-top: env(safe-area-inset-top, 0px);
  padding-bottom: env(safe-area-inset-bottom, 0px);
  padding-left: env(safe-area-inset-left, 0px);
  padding-right: env(safe-area-inset-right, 0px);
}

/* ===== Utility Classes ===== */
/* Hide on mobile */
.hide-mobile {
  display: block;
}

body.is-mobile .hide-mobile {
  display: none !important;
}

/* Show only on mobile */
.show-mobile {
  display: none;
}

body.is-mobile .show-mobile {
  display: block !important;
}

/* ===== Mobile Keyboard Handling ===== */
/**
 * SINGLE SOURCE OF TRUTH FOR KEYBOARD BEHAVIOR
 *
 * The --keyboard-height CSS variable is set by JavaScript (mobile.js)
 * when the virtual keyboard opens/closes.
 *
 * How it works:
 * 1. JS detects keyboard via visualViewport API
 * 2. JS sets --keyboard-height on :root
 * 3. JS adds/removes 'keyboard-open' class on body
 * 4. Layout-specific CSS (mobile-layout.css) uses --keyboard-height to shrink containers
 * 5. This file handles universal keyboard concerns (zoom, safe areas, etc.)
 */

/* Prevent iOS zoom on input focus - requires 16px minimum font-size */
body.is-mobile input,
body.is-mobile textarea,
body.is-mobile select {
  font-size: 16px !important;
  touch-action: manipulation;
}

/* Message input area - safe area when no keyboard */
body.is-mobile .message-input-container {
  margin-bottom: 0;
  padding-bottom: env(safe-area-inset-bottom, 0px);
  transition: padding-bottom 0.15s ease-out;
}

/* When keyboard is open, remove safe area padding (keyboard covers home indicator) */
body.is-mobile.keyboard-open .message-input-container {
  padding-bottom: 8px;
}

/* Prevent page scrolling when keyboard is open */
body.is-mobile.keyboard-open {
  touch-action: none;
}

body.is-mobile.keyboard-open .app-container {
  touch-action: pan-y; /* Allow vertical scroll within app only */
}

/* Ensure chat messages area can shrink */
body.is-mobile .chat-messages {
  flex: 1;
  min-height: 0;
  overflow-y: auto;
}

/* Bottom sheets should appear above keyboard */
body.is-mobile .bottom-sheet {
  bottom: var(--keyboard-height, 0px);
  transition: bottom 0.15s ease-out;
}

/* Modals with inputs should be scrollable when keyboard is up */
body.is-mobile .modal-content {
  max-height: calc(100vh - var(--keyboard-height, 0px) - 40px);
  overflow-y: auto;
}
